var MediaManager;(function(n){"use strict";n.STORAGE_KEY="MediaManagerIdentity";var t=function(){function t(i,r,u){var e,f;this._log=i,this._http=r,this._q=u,e=window.localStorage.getItem(n.STORAGE_KEY),e!==null&&(f=JSON.parse(e),f.hasOwnProperty("userId")&&f.hasOwnProperty("mobileServiceAuthenticationToken")&&(this._storedCredential=f,t._client.currentUser=f))}return t.$inject=["$log","$http","$q"],t._client=new WindowsAzure.MobileServiceClient("https://mediamanager.azure-mobile.net/","mEDaBeZpQeNRwXMrsQqnceotDgseEE15"),t.prototype.login=function(){var i=this;return t._client.login("twitter").then(function(t){var r=JSON.stringify(t);i._storedCredential=t,window.localStorage.setItem(n.STORAGE_KEY,r)})},t.prototype.logout=function(){this._storedCredential=null,this._user=null,window.localStorage.removeItem(n.STORAGE_KEY),t._client.logout()},t.prototype.getIsLoggedIn=function(){return t._client.currentUser!==null},t.prototype.getUser=function(){var t=this._q.defer();if(this._user!=null)t.resolve(this._user);else{var r=this._storedCredential.userId,u=r.substring(r.indexOf(":")+1),i=this;i._http.jsonp("https://api.twitter.com/1/users/show.json?user_id="+u+"&callback=JSON_CALLBACK").then(function(u){i._user=new n.User(r,u.data.name),t.resolve(i._user)},function(n){i._log.error(n),t.reject("Error retrieving user")})}return t.promise},t.prototype.getToken=function(){return this._storedCredential==null?null:this._storedCredential.mobileServiceAuthenticationToken},t}();n.AuthService=t,n.App.service("authService",t)})(MediaManager||(MediaManager={}))